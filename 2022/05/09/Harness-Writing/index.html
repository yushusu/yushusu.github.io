<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="A harness could be thought of as a minimally working application that ：  loads a library accepts a given input calls its entry functions exits when the execution finishes check if process died check i">
<meta property="og:type" content="article">
<meta property="og:title" content="Harness Writing">
<meta property="og:url" content="http://yushusu.github.io/2022/05/09/Harness-Writing/">
<meta property="og:site_name" content="YUSHUSU">
<meta property="og:description" content="A harness could be thought of as a minimally working application that ：  loads a library accepts a given input calls its entry functions exits when the execution finishes check if process died check i">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-05-09T03:13:30.000Z">
<meta property="article:modified_time" content="2023-07-09T03:17:01.438Z">
<meta property="article:author" content="yushusu">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>Harness Writing</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/archives/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/yushusu">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2022/07/08/UAFnote/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2022/03/09/Program-Analysis-Note-NJU/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yushusu.github.io/2022/05/09/Harness-Writing/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&text=Harness Writing"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&is_video=false&description=Harness Writing"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Harness Writing&body=Check out this article: http://yushusu.github.io/2022/05/09/Harness-Writing/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&name=Harness Writing&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yushusu.github.io/2022/05/09/Harness-Writing/&t=Harness Writing"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        Harness Writing
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">yushusu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2022-05-09T03:13:30.000Z" class="dt-published" itemprop="datePublished">2022-05-09</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>A harness could be thought of as a minimally working application that ：</p>
<ul>
<li>loads a library</li>
<li>accepts a given input</li>
<li>calls its entry functions</li>
<li>exits when the execution finishes</li>
<li>check if process died</li>
<li>check if process zombied</li>
<li>check PID</li>
<li>check logs</li>
<li>attach debugger,check process state</li>
</ul>
<p>开始调试发现调用了一个大小0x20的函数指针结构体，使用nop宏来分析其调用，然后根据调用来逆向每个nop所执行的动作。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br></pre></td><td class="code"><pre><span class="line">#include <span class="string">&quot;stdafx.h&quot;</span></span><br><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line">#include &lt;detours.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;fstream&gt;</span><br><span class="line">#include &lt;vector&gt;</span><br><span class="line"></span><br><span class="line">#define <span class="title function_">LOAD_FUNC</span><span class="params">(h, n)</span>                                      \</span><br><span class="line">    n##_func_t n##_func = (n##_func_t)GetProcAddress(h, #n); \</span><br><span class="line">    <span class="keyword">if</span> (!n##_func)                                           \</span><br><span class="line">    &#123;                                                        \</span><br><span class="line">        printf(<span class="string">&quot;failed to load function: &quot;</span> #n <span class="string">&quot;\n&quot;</span>);         \</span><br><span class="line">        exit(<span class="number">1</span>);                                             \</span><br><span class="line">    &#125;                                                        \</span><br><span class="line">    printf(<span class="string">&quot;pointer address of &quot;</span> #n <span class="string">&quot;: %p\n&quot;</span>, *n##_func);</span><br><span class="line"></span><br><span class="line">#define <span class="title function_">NOP</span><span class="params">(x)</span>                                                            \</span><br><span class="line">    <span class="type">int</span> nop##x()                                                          \</span><br><span class="line">    &#123;                                                                     \</span><br><span class="line">        printf(<span class="string">&quot;==&gt; nop%d called, %p\n&quot;</span>, x, __builtin_return_address(<span class="number">0</span>)); \</span><br><span class="line">        <span class="keyword">return</span> (DWORD)x;                                                  \</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">typedef <span class="title function_">int</span><span class="params">(__stdcall *JP2KLibInitEx_func_t)</span><span class="params">(vtable_t *vtbl)</span>;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> (*funcs[<span class="number">8</span>])();</span><br><span class="line">&#125; vtable_t;</span><br><span class="line"></span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">    FILE *fileptr;</span><br><span class="line">&#125; file_obj</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span></span><br><span class="line">    <span class="title function_">file_obj_is_readable</span><span class="params">(const file_obj_t *file)</span></span><br><span class="line">&#123;</span><br><span class="line">    printf(<span class="string">&quot;file_obj_is_readable called\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> (feof(file-&gt;fileptr)) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">file_obj_write</span><span class="params">(<span class="keyword">void</span> *fileptr, unsigned <span class="type">char</span> *data, <span class="type">int</span> param2)</span></span><br><span class="line">&#123;</span><br><span class="line">    printf(<span class="string">&quot;file_obj_write called with params fileptr=%p, data=%p, param2=%d\n&quot;</span>, fileptr, data, param2);</span><br><span class="line">    <span class="keyword">return</span> fwrite(data, <span class="number">1</span>, param2, fileptr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">file_obj_seek</span><span class="params">(FILE *fileptr, DWORD whence, uint64_t offset)</span></span><br><span class="line">&#123;</span><br><span class="line">    printf(<span class="string">&quot;file_obj_seek called with fileptr=%p, offset=%d, whence=%d\n&quot;</span>, fileptr, offset, whence);</span><br><span class="line">    uint64_t actual;</span><br><span class="line">    <span class="keyword">switch</span> (whence)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">        actual = SEEK_CUR;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        actual = SEEK_SET;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        actual = SEEK_END;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fseek(fileptr, offset, actual);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// reversing shows</span></span><br><span class="line"><span class="keyword">void</span> *nop0(<span class="type">int</span> size)</span><br><span class="line">&#123;</span><br><span class="line">    s1 *nstruct = (s1 *)malloc((sizeof(s1)));</span><br><span class="line">    nstruct-&gt;p1 = malloc(size);</span><br><span class="line">    nstruct-&gt;p2 = malloc(size);</span><br><span class="line">    nstruct-&gt;size = size;</span><br><span class="line">    nstruct-&gt;size2 = size;</span><br><span class="line">    <span class="keyword">return</span> nstruct;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> *nop1(s1 *nstruct)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> nstruct-&gt;p2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc &lt; <span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">&quot;usage : %s &lt;image file&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//使用nop来测试结构体的每个函数是干嘛用的</span></span><br><span class="line">    vtable_t vtable;</span><br><span class="line">    vtable.funcs[<span class="number">0</span>] = nop0;</span><br><span class="line">    vtable.funcs[<span class="number">1</span>] = nop1;</span><br><span class="line">    vtable.funcs[<span class="number">2</span>] = nop2;</span><br><span class="line">    vtable.funcs[<span class="number">3</span>] = nop3;</span><br><span class="line">    vtable.funcs[<span class="number">4</span>] = nop4;</span><br><span class="line">    vtable.funcs[<span class="number">5</span>] = nop5;</span><br><span class="line">    vtable.funcs[<span class="number">6</span>] = nop6;</span><br><span class="line">    vtable.funcs[<span class="number">7</span>] = nop7;</span><br><span class="line"></span><br><span class="line">    <span class="type">HMODULE</span> <span class="variable">jp2klib</span> <span class="operator">=</span> LoadLibraryA(<span class="string">&quot;JP2KLib.dll&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (jp2klib == NULL)</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">&quot;failed to load directory, gle = %d\n&quot;</span>, GetLastError());</span><br><span class="line">        exit(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    LOAD_FUNC(jp2klib, JP2KLibInitEx);</span><br><span class="line">    <span class="comment">// get return value by passing 0x20 vtable struct with nop functions and print return value</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> JP2KLibInitEx_func(&amp;vtable); <span class="comment">//JP2KLibInitEx_func就是JP2KLibInitEx的函数指针，传入放nopX的虚表</span></span><br><span class="line">    printf(<span class="string">&quot;JP2KLibInitEx: ret = %d\n&quot;</span>, ret);</span><br><span class="line"></span><br><span class="line">    LOAD_FUNC(jp2klib, JP2KGetMemObjEx);</span><br><span class="line">    <span class="keyword">void</span> *mem_obj = JP2KGetMemObjEx_func();</span><br><span class="line">    printf(<span class="string">&quot;JP2KGetMemObjEx : ret = %d\n&quot;</span>, mem_obj);</span><br><span class="line"></span><br><span class="line">    LOAD_FUNC(jp2klib, JP2KDecOptCreate);</span><br><span class="line">    <span class="type">int</span> <span class="variable">dec_opt</span> <span class="operator">=</span> JP2KDecOptCreate_func();</span><br><span class="line">    printf(<span class="string">&quot;JP2KDecOptCreate : ret = %d\n&quot;</span>, dec_opt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// create vtable</span></span><br><span class="line">    vtable_t procs;</span><br><span class="line">    <span class="comment">// assign relevant func pointers</span></span><br><span class="line">    procs.funcs[<span class="number">0</span>] = (<span class="keyword">void</span> *)nop_ret_0;</span><br><span class="line">    procs.funcs[<span class="number">1</span>] = (<span class="keyword">void</span> *)file_obj_die;</span><br><span class="line">    procs.funcs[<span class="number">2</span>] = (<span class="keyword">void</span> *)file_obj_read;</span><br><span class="line">    procs.funcs[<span class="number">3</span>] = (<span class="keyword">void</span> *)file_obj_write;</span><br><span class="line">    procs.funcs[<span class="number">4</span>] = (<span class="keyword">void</span> *)file_obj_seek;</span><br><span class="line">    procs.funcs[<span class="number">5</span>] = (<span class="keyword">void</span> *)file_obj_tellpos;</span><br><span class="line">    procs.funcs[<span class="number">6</span>] = (<span class="keyword">void</span> *)file_obj_is_seekable;</span><br><span class="line">    procs.funcs[<span class="number">7</span>] = (<span class="keyword">void</span> *)file_obj_is_readable;</span><br><span class="line">    procs.funcs[<span class="number">8</span>] = (<span class="keyword">void</span> *)file_obj_is_writeable;</span><br><span class="line">    procs.funcs[<span class="number">9</span>] = (<span class="keyword">void</span> *)&amp;procs;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// read file and store in file obj</span></span><br><span class="line">    file_obj_t fobj;</span><br><span class="line">    init_file(&amp;fobj, argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> (!(fobj.fileptr))</span><br><span class="line">    &#123;</span><br><span class="line">        printf(<span class="string">&quot;failed to load file object\n&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    printf(<span class="string">&quot;f_obj is at address: %p\n   with fobj-&gt;fileptr at: %p\n&quot;</span>, fobj, fobj.fileptr);</span><br><span class="line"></span><br><span class="line">    unknown *u = malloc(sizeof(unknown));</span><br><span class="line">    u-&gt;p1 = malloc(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">    printf(<span class="string">&quot;struct u has address: %p with p1=%p\n&quot;</span>, u, u-&gt;p1);</span><br><span class="line"></span><br><span class="line">    ret = JP2KImageInitDecoderEx_func(image, &amp;fobj, &amp;procs, dec_opt, u);</span><br><span class="line">    printf(<span class="string">&quot;JP2KImageInitDecoderEx: ret = %d\n&quot;</span>, ret);</span><br><span class="line">    <span class="comment">// if failed to decode we want to just exit so there&#x27;s no bogus crashes</span></span><br><span class="line">    <span class="keyword">if</span> (ret != <span class="number">0</span>)</span><br><span class="line">        printf(<span class="string">&quot;failed to decode.\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">max_res</span> <span class="operator">=</span> JP2KImageGetMaxRes_func(image);</span><br><span class="line">    printf(<span class="string">&quot;JP2KImageGetMaxRes: ret = %d\n&quot;</span>, max_res);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> *image_data = JP2KImageDataCreate_func();</span><br><span class="line">    printf(<span class="string">&quot;JP2KImageDataCreate: ret = %p\n&quot;</span>, image_data);</span><br><span class="line"></span><br><span class="line">    ret = JP2KImageDecodeTileInterleaved_func(image, <span class="number">0</span>, max_res, <span class="number">8</span>, <span class="number">0xff</span>, <span class="number">0</span>, image_data);</span><br><span class="line">    printf(<span class="string">&quot;JP2KImageDecodeTileInterleaved called with params max_res=%d: ret = %d\n&quot;</span>, max_res, ret); <span class="comment">/*  */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> *geometryParams = JP2KImageGetGeometryParams_func(image);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">numXTiles</span> <span class="operator">=</span> JP2KImageGeometryGetNumXTiles_func(geometryParams);</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="variable">numYTiles</span> <span class="operator">=</span> JP2KImageGeometryGetNumYTiles_func(geometryParams);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">tileY</span> <span class="operator">=</span> <span class="number">0</span>; tileY &lt; numYTiles; tileY++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">tileX</span> <span class="operator">=</span> <span class="number">0</span>; tileX &lt; numXTiles; tileX++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// call JP2KImageGeometryGetTileNum</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">tile_num</span> <span class="operator">=</span> JP2KImageGeometryGetTileNum_func(geometryParams, tileX, tileY);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// create image data</span></span><br><span class="line">            <span class="keyword">void</span> *image_data = JP2KImageDataCreate_func();</span><br><span class="line">            printf(<span class="string">&quot;JP2KImageDataCreate: ret = %p\n&quot;</span>, image_data);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// call DecodeTileInterleaved</span></span><br><span class="line">            ret = JP2KImageDecodeTileInterleaved_func(image, tile_num, max_res, <span class="number">8</span>, <span class="number">0xff</span>, <span class="number">0</span>, image_data);</span><br><span class="line">            printf(<span class="string">&quot;JP2KImageDecodeTileInterleaved called with params tile_num=%x, max_res=%d: ret = %d\n&quot;</span>, tile_num, <span class="number">5</span>, ret);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// destroy image data</span></span><br><span class="line">            ret = JP2KImageDataDestroy_func(image_data);</span><br><span class="line">            <span class="keyword">if</span> (ret == <span class="number">0</span>)</span><br><span class="line">                printf(<span class="string">&quot;image data destroyed.\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://ruan777.github.io/2021/07/18/fuzz_Acrobat_jp2klib/">别人</a>写的超级慢harness，参考<a target="_blank" rel="noopener" href="https://github1s.com/ronwai/jp2k_fuzz/blob/master/frida_harness.js#L325">大佬的</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br></pre></td><td class="code"><pre><span class="line">#define _CRT_SECURE_NO_WARNINGS</span><br><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line">#include &lt;iostream&gt;</span><br><span class="line">#include &lt;intrin.h&gt;</span><br><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// #define DEBUG</span></span><br><span class="line"></span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*pfunc_t)</span> (); </span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KLibInitEx_func_t)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="keyword">void</span>* (*JP2KGetMemObjEx_func_t)();</span><br><span class="line">typedef <span class="keyword">void</span>* (*JP2KDecOptCreate_func_t)();</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KDecOptInitToDefaults_func_t)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="keyword">void</span>* (*JP2KImageCreate_func_t)();</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KImageInitDecoderEx_func_t)</span><span class="params">(<span class="keyword">void</span>*,<span class="keyword">void</span>*,<span class="keyword">void</span>*,<span class="keyword">void</span>*,<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="keyword">void</span>* (*JP2KCodeStm_return_arg0)(<span class="keyword">void</span>*);</span><br><span class="line">typedef <span class="title function_">void</span> <span class="params">(*JP2KCodeStm_Die)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KCodeStm_Read)</span><span class="params">(<span class="keyword">void</span>*,<span class="keyword">void</span>*, <span class="type">int</span>)</span>;</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KCodeStm_Seek)</span><span class="params">(<span class="type">int</span>, <span class="type">int</span>)</span>;</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KCodeStm_Write)</span><span class="params">(<span class="keyword">void</span>*,<span class="keyword">void</span>*, <span class="type">int</span>)</span>;</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KCodeStm_TellPos)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KCodeStm_IsSeekAble)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KCodeStm_IsReadAble)</span><span class="params">(<span class="keyword">void</span>*)</span>;           </span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KCodeStm_IsWriteAble)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="keyword">void</span>* (*JP2KImageDataCreate_func_t)(<span class="keyword">void</span>);</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KImageGetMaxRes_func_t)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="title function_">int</span> <span class="params">(*JP2KImageDecodeTileInterleaved_func_t)</span><span class="params">(<span class="keyword">void</span>*, <span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>, <span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="title function_">void</span> <span class="params">(*JP2KImageDataDestroy_func_t)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="title function_">void</span> <span class="params">(*JP2KImageDestroy_func_t)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line">typedef <span class="title function_">void</span> <span class="params">(*JP2KDecOptDestroy_func_t)</span><span class="params">(<span class="keyword">void</span>*)</span>;</span><br><span class="line"></span><br><span class="line">JP2KLibInitEx_func_t JP2KLibInitEx_func;</span><br><span class="line">JP2KGetMemObjEx_func_t JP2KGetMemObjEx_func;</span><br><span class="line">JP2KDecOptCreate_func_t JP2KDecOptCreate_func;</span><br><span class="line">JP2KDecOptInitToDefaults_func_t JP2KDecOptInitToDefaults_func;</span><br><span class="line">JP2KImageCreate_func_t JP2KImageCreate_func;</span><br><span class="line">JP2KImageInitDecoderEx_func_t JP2KImageInitDecoderEx_func;</span><br><span class="line">JP2KImageDataCreate_func_t JP2KImageDataCreate_func;</span><br><span class="line">JP2KImageGetMaxRes_func_t JP2KImageGetMaxRes_func;</span><br><span class="line">JP2KImageDecodeTileInterleaved_func_t JP2KImageDecodeTileInterleaved_func;</span><br><span class="line">JP2KImageDataDestroy_func_t JP2KImageDataDestroy_func;</span><br><span class="line">JP2KImageDestroy_func_t JP2KImageDestroy_func;</span><br><span class="line">JP2KDecOptDestroy_func_t JP2KDecOptDestroy_func;</span><br><span class="line"></span><br><span class="line">#define <span class="title function_">LOAD_FUNC</span><span class="params">(h,n)</span>								\</span><br><span class="line">	n##_func = (n##_func_t)GetProcAddress(h,#n);	\</span><br><span class="line">	<span class="keyword">if</span>(!n##_func)&#123;									\</span><br><span class="line">		printf(<span class="string">&quot;failed to load function &quot;</span> # n <span class="string">&quot;\n&quot;</span>);\</span><br><span class="line">		exit(<span class="number">1</span>);									\</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">#define <span class="title function_">NOP</span><span class="params">(x)</span>										\</span><br><span class="line">	<span class="type">int</span> nop##x()&#123;									\</span><br><span class="line">		printf(<span class="string">&quot;==&gt; nop%d called, %p\n&quot;</span>,##x,_ReturnAddress());	\</span><br><span class="line">		<span class="keyword">return</span> (DWORD)x;							\</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">NOP(<span class="number">0</span>)</span><br><span class="line">NOP(<span class="number">1</span>)</span><br><span class="line">NOP(<span class="number">2</span>)</span><br><span class="line">NOP(<span class="number">3</span>)</span><br><span class="line">NOP(<span class="number">4</span>)</span><br><span class="line">NOP(<span class="number">5</span>)</span><br><span class="line">NOP(<span class="number">6</span>)</span><br><span class="line">NOP(<span class="number">7</span>)</span><br><span class="line">NOP(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* init_something() &#123;</span><br><span class="line">	<span class="keyword">return</span> malloc(<span class="number">0x14</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* malloc_1(<span class="type">int</span> size) &#123;</span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;malloc 0x%x byte\n&quot;</span>, size)</span>;</span><br><span class="line">#endif</span><br><span class="line">	<span class="keyword">return</span> malloc(size);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* memset_1(<span class="keyword">void</span>* dst, <span class="type">int</span> value, <span class="type">int</span> size) &#123;</span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;memset(0x%p,0x%x,0x%x)\n&quot;</span>,dst, value, size)</span>;</span><br><span class="line">#endif</span><br><span class="line">	<span class="title function_">memset</span><span class="params">(dst, value, size)</span>;</span><br><span class="line">	<span class="keyword">return</span> dst;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* memcpy_1(<span class="keyword">void</span>* dst, <span class="keyword">void</span>* src, <span class="type">int</span> size) &#123;</span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;memcpy(0x%p,0x%p,0x%x)\n&quot;</span>,dst,src,size)</span>;</span><br><span class="line">#endif</span><br><span class="line">	<span class="title function_">memcpy</span><span class="params">(dst, src, size)</span>;</span><br><span class="line">	<span class="keyword">return</span> dst;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">free_1</span><span class="params">(<span class="keyword">void</span>* p)</span> &#123;</span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;free(0x%p)\n&quot;</span>, p)</span>;</span><br><span class="line">#endif</span><br><span class="line">	<span class="title function_">free</span><span class="params">(p)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">ret_1</span><span class="params">()</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* return_arg0_func(<span class="keyword">void</span>* arg0) &#123;</span><br><span class="line">	<span class="keyword">return</span> arg0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">struct MemObjEx &#123;</span><br><span class="line">	<span class="comment">// void* (__cdecl* init_something_)(void);		// need implement</span></span><br><span class="line">	pfunc_t funcs_0;</span><br><span class="line">	pfunc_t funcs_1;</span><br><span class="line">	pfunc_t funcs_2;</span><br><span class="line">	pfunc_t funcs_3;</span><br><span class="line">	<span class="keyword">void</span>* (__cdecl* malloc_1)(<span class="type">int</span>);</span><br><span class="line">	<span class="keyword">void</span> (__cdecl* free_1)(<span class="keyword">void</span>*);</span><br><span class="line">	<span class="keyword">void</span>* (__cdecl* memcpy_1)(<span class="keyword">void</span>*,<span class="keyword">void</span>*,<span class="type">int</span>);</span><br><span class="line">	pfunc_t funcs_7;</span><br><span class="line">	<span class="keyword">void</span>* (__cdecl* memset_1)(<span class="keyword">void</span>*, <span class="type">int</span>, <span class="type">int</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct decOpt</span><br><span class="line">&#123;</span><br><span class="line">	DWORD unk_1;</span><br><span class="line">	DWORD unk_2;</span><br><span class="line">	DWORD unk_3;</span><br><span class="line">	DWORD unk_4;</span><br><span class="line">	DWORD unk_5;</span><br><span class="line">	DWORD unk_6;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct stmProcs &#123;</span><br><span class="line">	JP2KCodeStm_return_arg0 return_arg0;</span><br><span class="line">	JP2KCodeStm_Die die;</span><br><span class="line">	JP2KCodeStm_Read read;</span><br><span class="line">	JP2KCodeStm_Write write;</span><br><span class="line">	JP2KCodeStm_Seek seek;</span><br><span class="line">	JP2KCodeStm_TellPos tellPos;</span><br><span class="line">	JP2KCodeStm_IsSeekAble seek_able;</span><br><span class="line">	JP2KCodeStm_IsReadAble read_able;</span><br><span class="line">	JP2KCodeStm_IsWriteAble write_able;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">struct file_t &#123;</span><br><span class="line">	<span class="type">int</span> pos;</span><br><span class="line">	<span class="type">char</span>* buf;</span><br><span class="line">	DWORD filesize;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">file_t global_file_obj;</span><br><span class="line"></span><br><span class="line"><span class="comment">// define our function</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">my_read</span><span class="params">(<span class="keyword">void</span>* dummy_this,<span class="keyword">void</span>* buf,<span class="type">int</span> size)</span> &#123;</span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;in my_read memcpy(0x%p,0x%p,0x%x)\n&quot;</span>,buf,global_file_obj.buf+global_file_obj.pos,size)</span>;</span><br><span class="line">#endif</span><br><span class="line">	<span class="type">int</span> <span class="variable">byteRead</span> <span class="operator">=</span> global_file_obj.pos + size &gt; global_file_obj.filesize ?</span><br><span class="line">		global_file_obj.filesize - global_file_obj.pos : size;</span><br><span class="line"></span><br><span class="line">	memcpy(buf, global_file_obj.buf + global_file_obj.pos, byteRead);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> byteRead;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">my_seek</span><span class="params">(<span class="type">int</span> flags, <span class="type">int</span> offset)</span> &#123;</span><br><span class="line">	<span class="keyword">switch</span> (flags) &#123;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">0</span>: </span><br><span class="line">	<span class="keyword">case</span> <span class="number">1</span>: &#123;</span><br><span class="line">		global_file_obj.pos += offset;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">case</span> <span class="number">2</span>: &#123;</span><br><span class="line">		global_file_obj.pos = global_file_obj.filesize;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> global_file_obj.pos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">my_die</span><span class="params">(<span class="keyword">void</span>* t)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">my_write</span><span class="params">(<span class="keyword">void</span>* dummy_this,<span class="keyword">void</span>* dst, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;in my_write : memcpy(0x%p,0x%p,0x%x)\n&quot;</span>, dst, global_file_obj.buf + global_file_obj.pos, size)</span>;</span><br><span class="line">#endif</span><br><span class="line">	<span class="title function_">memcpy</span><span class="params">(dst, global_file_obj.buf + global_file_obj.pos, size)</span>;</span><br><span class="line">	global_file_obj.pos += size;</span><br><span class="line">	<span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">my_tellPos</span><span class="params">(<span class="keyword">void</span>* dummy)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> global_file_obj.pos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">is_read_able</span><span class="params">(<span class="keyword">void</span>* dummy)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">is_seek_able</span><span class="params">(<span class="keyword">void</span>* dummy)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">is_write_able</span><span class="params">(<span class="keyword">void</span>* dummy)</span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">init_file_obj</span><span class="params">(file_t* fileobj, const <span class="type">char</span>* filename)</span> &#123;</span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	FILE* fp = fopen(filename, &quot;rb&quot;);</span></span><br><span class="line"><span class="comment">	if (fp == NULL)</span></span><br><span class="line"><span class="comment">		exit(0);</span></span><br><span class="line"><span class="comment">	fseek(fp,0,SEEK_END);</span></span><br><span class="line"><span class="comment">	fileobj-&gt;filesize = ftell(fp);</span></span><br><span class="line"><span class="comment">	fseek(fp, 0, SEEK_SET);</span></span><br><span class="line"><span class="comment">	fileobj-&gt;buf = new char[fileobj-&gt;filesize+4];</span></span><br><span class="line"><span class="comment">	fileobj-&gt;pos = 0;</span></span><br><span class="line"><span class="comment">	fread(fileobj-&gt;buf, 1, fileobj-&gt;filesize, fp);</span></span><br><span class="line"><span class="comment">	fclose(fp);</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="type">HANDLE</span> <span class="variable">hFILE</span> <span class="operator">=</span> CreateFileA((LPCSTR)filename, GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, FILE_ATTRIBUTE_NORMAL, NULL);</span><br><span class="line"></span><br><span class="line">	DWORD bytestoread;</span><br><span class="line">	<span class="type">DWORD</span> <span class="variable">filesize</span> <span class="operator">=</span> GetFileSize(hFILE, NULL);</span><br><span class="line">	fileobj-&gt;filesize = filesize;</span><br><span class="line">	fileobj-&gt;buf = <span class="keyword">new</span> <span class="title class_">char</span>[filesize + <span class="number">4</span>];</span><br><span class="line">	fileobj-&gt;pos = <span class="number">0</span>;</span><br><span class="line">	ReadFile(hFILE,fileobj-&gt;buf,filesize,&amp;bytestoread,NULL);</span><br><span class="line">	<span class="comment">// printf(&quot;hFILE %d, file size : %d, bytestoRead : %d\n&quot;,hFILE, filesize, bytestoread);</span></span><br><span class="line">	CloseHandle(hFILE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">extern <span class="string">&quot;C&quot;</span> __declspec(dllexport) <span class="type">int</span> <span class="title function_">fuzz_me</span><span class="params">(<span class="type">char</span>* filename)</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span>* mem_obj;</span><br><span class="line">MemObjEx memobj;</span><br><span class="line">decOpt decopt_obj;</span><br><span class="line">stmProcs* stmProc = <span class="keyword">new</span> <span class="title class_">stmProcs</span>;</span><br><span class="line"><span class="type">char</span>* unknown3[<span class="number">0x100</span>];</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">fuzz_me</span><span class="params">(<span class="type">char</span>* filename)</span> &#123;</span><br><span class="line">	memset(unknown3, <span class="number">0</span>, <span class="number">0x100</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">void</span>* opt_obj = JP2KDecOptCreate_func();</span><br><span class="line">	JP2KDecOptInitToDefaults_func(opt_obj);</span><br><span class="line">	<span class="keyword">void</span>* image_obj = JP2KImageCreate_func();</span><br><span class="line"></span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;mem_obj = 0x%p\n&quot;</span>, mem_obj)</span>;</span><br><span class="line">	printf(<span class="string">&quot;image_obj = 0x%p\n&quot;</span>, image_obj);</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line">	<span class="title function_">init_file_obj</span><span class="params">(&amp;global_file_obj, filename)</span>;</span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> JP2KImageInitDecoderEx_func(image_obj, &amp;global_file_obj, stmProc, opt_obj, unknown3);</span><br><span class="line">	printf(<span class="string">&quot;JP2KImageInitDecoderEx ret = %d\n&quot;</span>, ret);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// void* image_data = JP2KImageDataCreate_func();</span></span><br><span class="line">	<span class="comment">// int max_res = JP2KImageGetMaxRes_func(image_obj);</span></span><br><span class="line">	<span class="comment">// ret = JP2KImageDecodeTileInterleaved_func(image_obj,0,max_res,8,0xff,0,image_data);</span></span><br><span class="line">	<span class="comment">// printf(&quot;JP2KImageDecodeTileInterleaved ret = %d\n&quot;, ret);</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// JP2KImageDataDestroy_func(image_data);</span></span><br><span class="line">	JP2KImageDestroy_func(image_obj);</span><br><span class="line">	JP2KDecOptDestroy_func(opt_obj);</span><br><span class="line"></span><br><span class="line">	delete[] global_file_obj.buf;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">	<span class="keyword">if</span> (argc &lt; <span class="number">2</span>) &#123;</span><br><span class="line">		printf(<span class="string">&quot;Usage : %s &lt;input file&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	memobj.funcs_0 = nop0;</span><br><span class="line">	memobj.funcs_1 = nop1;</span><br><span class="line">	memobj.funcs_2 = nop2;</span><br><span class="line">	memobj.funcs_3 = nop3;</span><br><span class="line">	memobj.malloc_1 = malloc_1;</span><br><span class="line">	memobj.free_1 = free_1;</span><br><span class="line">	memobj.memcpy_1 = memcpy_1;</span><br><span class="line">	memobj.funcs_7 = nop7;</span><br><span class="line">	memobj.memset_1 = memset_1;</span><br><span class="line"></span><br><span class="line">	<span class="type">HMODULE</span> <span class="variable">hJp2klib</span> <span class="operator">=</span> LoadLibraryA(<span class="string">&quot;C:\\Program Files (x86)\\Adobe\\Acrobat Reader DC\\Reader\\JP2Klib.dll&quot;</span>);</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (hJp2klib == NULL) &#123;</span><br><span class="line">		printf(<span class="string">&quot;failed to load library, last error %d\n&quot;</span>, GetLastError());</span><br><span class="line">		exit(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KLibInitEx);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KGetMemObjEx);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KDecOptCreate);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KDecOptInitToDefaults);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KImageCreate);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KImageInitDecoderEx);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KImageDataCreate);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KImageGetMaxRes);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KImageDecodeTileInterleaved);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KImageDataDestroy);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KImageDestroy);</span><br><span class="line">	LOAD_FUNC(hJp2klib, JP2KDecOptDestroy);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// JP2KCodeStm_IsSeekAble JP2KCodeStm_seekable_func = (JP2KCodeStm_IsSeekAble)GetProcAddress(hJp2klib,&quot;?IsSeekable@JP2KCodeStm@@QAE_NXZ&quot;);</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// setup our vtable </span></span><br><span class="line">	stmProc-&gt;return_arg0 = return_arg0_func;</span><br><span class="line">	stmProc-&gt;die = my_die;</span><br><span class="line">	stmProc-&gt;read = my_read;</span><br><span class="line">	stmProc-&gt;seek = my_seek;</span><br><span class="line">	stmProc-&gt;write = my_write;</span><br><span class="line">	stmProc-&gt;tellPos = my_tellPos;</span><br><span class="line">	stmProc-&gt;seek_able = is_seek_able;</span><br><span class="line">	stmProc-&gt;read_able = is_read_able;</span><br><span class="line">	stmProc-&gt;write_able = is_write_able;</span><br><span class="line"></span><br><span class="line">#ifdef DEBUG</span><br><span class="line">	<span class="title function_">printf</span><span class="params">(<span class="string">&quot;JP2KLibInitEx at 0x%p\n&quot;</span>, JP2KLibInitEx_func)</span>;</span><br><span class="line">	printf(<span class="string">&quot;JP2KGetMemObjEx at 0x%p\n&quot;</span>, JP2KGetMemObjEx_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KDecOptCreate at 0x%p\n&quot;</span>, JP2KDecOptCreate_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KDecOptInitToDefaults at 0x%p\n&quot;</span>, JP2KDecOptInitToDefaults_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KImageCreate at 0x%p\n&quot;</span>, JP2KImageCreate_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KImageInitDecoderEx at 0x%p\n&quot;</span>, JP2KImageInitDecoderEx_func);</span><br><span class="line">	<span class="comment">// printf(&quot;JP2KCodeStm::IsSeekable at 0x%p\n&quot;, JP2KCodeStm_seekable_func);</span></span><br><span class="line">	printf(<span class="string">&quot;JP2KImageDataCreate at 0x%p\n&quot;</span>, JP2KImageDataCreate_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KImageGetMaxRes at 0x%p\n&quot;</span>, JP2KImageGetMaxRes_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KImageDecodeTileInterleaved at 0x%p\n&quot;</span>, JP2KImageDecodeTileInterleaved_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KImageDataDestroy at 0x%p\n&quot;</span>, JP2KImageDataDestroy_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KImageDestroy at 0x%p\n&quot;</span>, JP2KImageDestroy_func);</span><br><span class="line">	printf(<span class="string">&quot;JP2KDecOptDestroy at 0x%p\n&quot;</span>, JP2KDecOptDestroy_func);</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">	<span class="title function_">JP2KLibInitEx_func</span><span class="params">(&amp;memobj)</span>;</span><br><span class="line">	mem_obj = JP2KGetMemObjEx_func();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// fuzz func</span></span><br><span class="line">	fuzz_me(argv[<span class="number">1</span>]);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/archives/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/yushusu">Projects</a></li>
        
      </ul>
    </div>

    
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yushusu.github.io/2022/05/09/Harness-Writing/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&text=Harness Writing"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&is_video=false&description=Harness Writing"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=Harness Writing&body=Check out this article: http://yushusu.github.io/2022/05/09/Harness-Writing/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&title=Harness Writing"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yushusu.github.io/2022/05/09/Harness-Writing/&name=Harness Writing&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yushusu.github.io/2022/05/09/Harness-Writing/&t=Harness Writing"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    yushusu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/archives/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/yushusu">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
