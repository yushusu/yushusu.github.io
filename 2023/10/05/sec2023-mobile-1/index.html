<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="ida mac fix the crash：（suggest using paradell windows） delete~&#x2F;.idapro&#x2F;ida.reg adb shell am start -D -n com.com.sec2023.rocketmouse.mouse&#x2F;com.unity3d.player.UnityPlayerActivityStarting:">
<meta property="og:type" content="article">
<meta property="og:title" content="sec2023_mobile-1">
<meta property="og:url" content="http://yushusu.github.io/2023/10/05/sec2023-mobile-1/">
<meta property="og:site_name" content="YUSHUSU">
<meta property="og:description" content="ida mac fix the crash：（suggest using paradell windows） delete~&#x2F;.idapro&#x2F;ida.reg adb shell am start -D -n com.com.sec2023.rocketmouse.mouse&#x2F;com.unity3d.player.UnityPlayerActivityStarting:">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2023-10-05T13:57:26.000Z">
<meta property="article:modified_time" content="2023-10-06T07:35:26.195Z">
<meta property="article:author" content="yushusu">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>sec2023_mobile-1</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/archives/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/yushusu">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="Previous post" href="/2023/10/20/Fuzzilli-REPRL/"><i class="fa-solid fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="Next post" href="/2023/10/04/2018-N1ctf-baby-unity3d/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&text=sec2023_mobile-1"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&is_video=false&description=sec2023_mobile-1"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=sec2023_mobile-1&body=Check out this article: http://yushusu.github.io/2023/10/05/sec2023-mobile-1/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&name=sec2023_mobile-1&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&t=sec2023_mobile-1"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        sec2023_mobile-1
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">yushusu</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2023-10-05T13:57:26.000Z" class="dt-published" itemprop="datePublished">2023-10-05</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p><strong>ida mac fix the crash：（suggest using paradell windows）</strong></p>
<p>delete~&#x2F;.idapro&#x2F;ida.reg</p>
<p>adb shell am start -D -n com.com.sec2023.rocketmouse.mouse&#x2F;com.unity3d.player.UnityPlayerActivity<br>Starting: Intent { cmp&#x3D;com.com.sec2023.rocketmouse.mouse&#x2F;com.unity3d.player.UnityPlayerActivity }</p>
<p><strong>Step 1 : Open ida to see if <a target="_blank" rel="noopener" href="http://libil2cpp.so/">libil2cpp.so</a> is encrypted. Use frida dump and find that there is a detection (hack detect). Modify the frida characteristics to bypass the memory dump detection:</strong></p>
<p>we can modify the port number in the Frida source code, the temporary directory or the relevant string characteristics in the maps. For this one, we can directly modify the port <code>./fridasever -l 0.0.0.0:1234</code></p>
<p>modify port</p>
<p>change Frida port to lisenning in frida-core&#x2F;src&#x2F;frida-gadget-server.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#define DEFAULT_LISTEN_ADDRESS &quot;127.0.0.1&quot;</span><br><span class="line">#define DEFAULT_LISTEN_PORT    27042</span><br></pre></td></tr></table></figure>

<p>change the port behind DEFAULT_LISTEN_PORT</p>
<p>temporary directory</p>
<p>frida-core&#x2F;src&#x2F;frida-helper-backend-linux.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">static gchar *</span><br><span class="line">frida_helper_backend_get_system_temp_path (void)</span><br><span class="line">&#123;</span><br><span class="line">  return g_strdup (&quot;/tmp&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>change the “&#x2F;tmp” path</p>
<p>maps relevant strings</p>
<p>frida-core&#x2F;src&#x2F;frida-helper-backend-linux.c</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if (strstr (line, &quot;/libc.&quot;) || strstr (line, &quot;/libm.&quot;) || strstr (line, &quot;/libdl.&quot;))</span><br><span class="line">&#123;</span><br><span class="line">  frida_helper_backend_linux_parse_maps_entry (line, entry);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>then using dump so script :</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dump_so</span>(<span class="params">so_name</span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> currentApplication = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.ActivityThread&quot;</span>).<span class="title function_">currentApplication</span>();</span><br><span class="line">        <span class="keyword">var</span> dir = currentApplication.<span class="title function_">getApplicationContext</span>().<span class="title function_">getFilesDir</span>().<span class="title function_">getPath</span>();</span><br><span class="line">        <span class="keyword">var</span> libso = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(so_name);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[name]:&quot;</span>, libso.<span class="property">name</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[base]:&quot;</span>, libso.<span class="property">base</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[size]:&quot;</span>, <span class="title function_">ptr</span>(libso.<span class="property">size</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[path]:&quot;</span>, libso.<span class="property">path</span>);</span><br><span class="line">        <span class="keyword">var</span> file_path = dir + <span class="string">&quot;/&quot;</span> + libso.<span class="property">name</span> + <span class="string">&quot;_&quot;</span> + libso.<span class="property">base</span> + <span class="string">&quot;_&quot;</span> + <span class="title function_">ptr</span>(libso.<span class="property">size</span>) + <span class="string">&quot;.so&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> file_handle = <span class="keyword">new</span> <span class="title class_">File</span>(file_path, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (file_handle &amp;&amp; file_handle != <span class="literal">null</span>) &#123;</span><br><span class="line">				<span class="comment">//Memory.protect(ptr(libso.base.add(0x13b7000)), libso.size-0x13b7000, &#x27;rwx&#x27;);</span></span><br><span class="line">            <span class="title class_">Memory</span>.<span class="title function_">protect</span>(<span class="title function_">ptr</span>(libso.<span class="property">base</span>), libso.<span class="property">size</span>, <span class="string">&#x27;rwx&#x27;</span>);</span><br><span class="line">            <span class="keyword">var</span> libso_buffer = <span class="title function_">ptr</span>(libso.<span class="property">base</span>).<span class="title function_">readByteArray</span>(libso.<span class="property">size</span>);</span><br><span class="line">            file_handle.<span class="title function_">write</span>(libso_buffer);</span><br><span class="line">            file_handle.<span class="title function_">flush</span>();</span><br><span class="line">            file_handle.<span class="title function_">close</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[dump]:&quot;</span>, file_path);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">rpc.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">dump_so</span>: dump_so</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//frida -H 127.0.0.1:1234 -l &quot;libil2cpp_dump.js&quot; -f &quot;com.com.sec2023.rocketmouse.mouse&quot;</span></span><br></pre></td></tr></table></figure>

<p>then using Il2CppDumper dump dumped <a target="_blank" rel="noopener" href="http://libil2cpp.so/">libil2cpp.so</a> to get string information.</p>
<p>S<strong>tep 2 : repair the dumped libil2cpp.so</strong></p>
<p>the dumped so file inside section using VA address offset, we should repair it when compare with original apk so file inside <code>Program Header Table</code>、<code>section_header_table</code>、<code>elf_header-&gt;e_shtrndx_STRING_TABLE_INDEX</code> using 010editor. Then IDA rebase segment and click <code>File-&gt;Script file...</code>run<code>il2cppdumper</code>which provided<code>da_with_struct_py3.py</code> to repair struct.</p>
<p> <strong>Or Step 2 : The .so file may decrypt before dlopen function load it，we can try to hook dlopen dump <a target="_blank" rel="noopener" href="http://libil2cpp.so/">libil2cpp.so</a>, then fill in the tail relocation table：</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">WriteMemToFile</span>(<span class="params">addr, size, file_path</span>) &#123;</span><br><span class="line">  <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> prefix = <span class="string">&#x27;/data/data/com.com.sec2023.rocketmouse.mouse/files/&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> mkdir = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;mkdir&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> chmod = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;chmod&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> fopen = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;fopen&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> fwrite = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;fwrite&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> fclose = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&#x27;libc.so&#x27;</span>, <span class="string">&#x27;fclose&#x27;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">var</span> call_mkdir = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(mkdir, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">    <span class="keyword">var</span> call_chmod = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(chmod, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>]);</span><br><span class="line">    <span class="keyword">var</span> call_fopen =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(fopen, <span class="string">&#x27;pointer&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">    <span class="keyword">var</span> call_fwrite =</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(fwrite, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;int&#x27;</span>, <span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line">    <span class="keyword">var</span> call_fclose = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(fclose, <span class="string">&#x27;int&#x27;</span>, [<span class="string">&#x27;pointer&#x27;</span>]);</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">call_mkdir</span>(<span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(prefix), <span class="number">0x1FF</span>);</span><br><span class="line">    <span class="title function_">call_chmod</span>(<span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(prefix), <span class="number">0x1FF</span>);</span><br><span class="line">    <span class="keyword">var</span> fp = <span class="title function_">call_fopen</span>(</span><br><span class="line">        <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(prefix + file_path),</span><br><span class="line">        <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(<span class="string">&#x27;wb&#x27;</span>));</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_">call_fwrite</span>(addr, <span class="number">1</span>, size, fp)) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Write file success, file path: &#x27;</span> + prefix + file_path);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[x] Write file failed&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="title function_">call_fclose</span>(fp);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">HookLibWithCallback</span>(<span class="params">name, callback</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> dlopen = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&#x27;libdl.so&#x27;</span>, <span class="string">&#x27;dlopen&#x27;</span>);</span><br><span class="line">  <span class="keyword">var</span> detach_listener = <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(dlopen, &#123;</span><br><span class="line">    <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> cur = args[<span class="number">0</span>].<span class="title function_">readCString</span>();</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] dlopen called, name: &#x27;</span> + cur);</span><br><span class="line">      <span class="keyword">if</span> (cur.<span class="title function_">indexOf</span>(name) != -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">hook</span> = <span class="literal">true</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">hook</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] Hook Lib success, name:&#x27;</span>, name);</span><br><span class="line">        <span class="title function_">callback</span>();</span><br><span class="line">        detach_listener.<span class="title function_">detach</span>();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">DumpIL2CPP</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> libil2cpp = <span class="title class_">TraverseModules</span>(<span class="string">&#x27;single&#x27;</span>, &#123;<span class="attr">name</span>: <span class="string">&#x27;libil2cpp.so&#x27;</span>&#125;);</span><br><span class="line">  <span class="title class_">WriteMemToFile</span>(libil2cpp.<span class="property">base</span>, libil2cpp.<span class="property">size</span>, <span class="string">&#x27;libil2cpp.so&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title class_">HookLibWithCallback</span>(<span class="string">&#x27;libil2cpp.so&#x27;</span>, <span class="title class_">DumpIL2CPP</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="title function_">main</span>();</span><br></pre></td></tr></table></figure>

<p>then track the Colletcoin function found an auto-increment logic to patch got the first flag:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">function <span class="title function_">TraverseModules</span><span class="params">(mode, &#123;name = <span class="string">&#x27;&#x27;</span>, name_array = []&#125;)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (mode == <span class="string">&#x27;all&#x27;</span>) &#123;</span><br><span class="line">      <span class="type">var</span> <span class="variable">modules</span> <span class="operator">=</span> Process.enumerateModules();</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">var</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; modules.length; i++) &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">module</span> <span class="operator">=</span> modules[i];</span><br><span class="line">        <span class="comment">// LogModule(module);</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> modules;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="string">&#x27;single&#x27;</span>) &#123;</span><br><span class="line">      <span class="type">var</span> <span class="variable">module</span> <span class="operator">=</span> Process.getModuleByName(name);</span><br><span class="line">      LogModule(<span class="keyword">module</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">module</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (mode == <span class="string">&#x27;multiple&#x27;</span>) &#123;</span><br><span class="line">      <span class="type">var</span> <span class="variable">modules</span> <span class="operator">=</span> Process.enumerateModules();</span><br><span class="line">      <span class="type">var</span> <span class="variable">target_modules</span> <span class="operator">=</span> [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="type">var</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; modules.length; i++) &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">module</span> <span class="operator">=</span> modules[i];</span><br><span class="line">        <span class="keyword">if</span> (name_array.indexOf(<span class="keyword">module</span>.name) != -<span class="number">1</span>) &#123;</span><br><span class="line">          LogModule(<span class="keyword">module</span>);</span><br><span class="line">          target_modules.push(<span class="keyword">module</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> target_modules;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">function <span class="title function_">PatchIncrease</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">var</span> <span class="variable">libil2cpp</span> <span class="operator">=</span> TraverseModules(<span class="string">&#x27;single&#x27;</span>, &#123;name: <span class="string">&#x27;libil2cpp.so&#x27;</span>&#125;);</span><br><span class="line">  <span class="type">var</span> <span class="variable">insn</span> <span class="operator">=</span> libil2cpp.base.add(<span class="number">0x465674</span>);</span><br><span class="line">  console.log(<span class="string">&#x27;[+] Patching..&#x27;</span>);</span><br><span class="line">  Memory.protect(insn, <span class="number">4</span>, <span class="string">&#x27;rwx&#x27;</span>);</span><br><span class="line">  insn.writeByteArray([<span class="number">0x01</span>, <span class="number">0xA0</span>, <span class="number">0x0F</span>, <span class="number">0x11</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Step 3 : using fridail2cppdumper find the button:</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">frida -H <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">1234</span> -l <span class="string">&quot;_agent.js&quot;</span> -f <span class="string">&quot;com.com.sec2023.rocketmouse.mouse&quot;</span></span><br></pre></td></tr></table></figure>

<p><strong>Step 4:  Track the process found there is a BR jump to a defined offset 0x48 import at libsec2023.so, open the so file located function sub_31164 but hack detect</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_sub_31164</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(<span class="string">&quot;libsec2023.so&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> addr=<span class="variable language_">module</span>.<span class="property">base</span>.<span class="title function_">add</span>(<span class="string">&quot;0x31164&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> func =  <span class="keyword">new</span> <span class="title class_">NativePointer</span>(addr.<span class="title function_">toString</span>());</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] hook &#x27;</span>+func.<span class="title function_">toString</span>())</span><br><span class="line"> </span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(func, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">      </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook success&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">1</span>]);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">2</span>]);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;retvalue is :&quot;</span>, retval.<span class="title function_">toInt32</span>());</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;method onleave&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">rpc.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">hook_sub_35404</span>: hook_sub_35404</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>So we use frida Stalker to print the process of so calling.</p>
<p>First use the following idaPython script to print out the addresses and names of all functions of <a target="_blank" rel="noopener" href="http://libsec2023.so/">libsec2023.so</a>.</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> idautils</span><br><span class="line"><span class="keyword">import</span> idc</span><br><span class="line"> </span><br><span class="line">func_addr = []</span><br><span class="line">func_name = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> idautils.<span class="title class_">Functions</span>():</span><br><span class="line">    func_addr.<span class="title function_">append</span>(i)</span><br><span class="line">    func_name.<span class="title function_">append</span>(idc.<span class="title function_">get_func_name</span>(i))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="attr">func_addr</span>:</span><br><span class="line">    <span class="title function_">print</span>(f<span class="string">&quot;&#123;hex(i)&#125;, &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="attr">func_name</span>:</span><br><span class="line">    <span class="title function_">print</span>(f<span class="string">&quot;\&quot;&#123;i&#125;\&quot;, &quot;</span>,end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Second Stalker switch on</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> func_addr = [...] <span class="comment">// fill the value print in idapython</span></span><br><span class="line"><span class="keyword">var</span> func_name = [...]</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_dlopen</span>(<span class="params">soName = <span class="string">&#x27;&#x27;</span></span>) &#123;</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;android_dlopen_ext&quot;</span>),</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (pathptr !== <span class="literal">undefined</span> &amp;&amp; pathptr != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">var</span> path = <span class="title function_">ptr</span>(pathptr).<span class="title function_">readCString</span>();</span><br><span class="line">                    <span class="keyword">if</span> (path.<span class="title function_">indexOf</span>(soName) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">is_can_hook</span> = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">is_can_hook</span>) &#123;</span><br><span class="line">                    <span class="comment">//hook_sub_3530C();</span></span><br><span class="line">                    <span class="keyword">var</span> times = <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(<span class="string">&quot;libsec2023.so&quot;</span>);</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">pid</span> = <span class="title class_">Process</span>.<span class="title function_">getCurrentThreadId</span>();</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;start Stalker!&quot;</span>);</span><br><span class="line">                    <span class="title class_">Stalker</span>.<span class="title function_">follow</span>(<span class="variable language_">this</span>.<span class="property">pid</span>,&#123;</span><br><span class="line">                        <span class="attr">events</span>:&#123;</span><br><span class="line">                            <span class="attr">call</span>:<span class="literal">false</span>,</span><br><span class="line">                            <span class="attr">ret</span>:<span class="literal">false</span>,</span><br><span class="line">                            <span class="attr">exec</span>:<span class="literal">false</span>,</span><br><span class="line">                            <span class="attr">block</span>:<span class="literal">false</span>,</span><br><span class="line">                            <span class="attr">compile</span>:<span class="literal">false</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">onReceive</span>:<span class="keyword">function</span>(<span class="params">events</span>)&#123;</span><br><span class="line">                        &#125;,</span><br><span class="line">                        <span class="attr">transform</span>: <span class="keyword">function</span> (<span class="params">iterator</span>) &#123;</span><br><span class="line">                            <span class="keyword">var</span> instruction = iterator.<span class="title function_">next</span>();</span><br><span class="line">                            <span class="keyword">do</span>&#123;</span><br><span class="line">                                <span class="keyword">if</span> (func_addr.<span class="title function_">indexOf</span>(instruction.<span class="property">address</span> - <span class="variable language_">module</span>.<span class="property">base</span>) != -<span class="number">1</span>)&#123;</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;call&quot;</span> + times+ <span class="string">&quot;:&quot;</span> + func_name[func_addr.<span class="title function_">indexOf</span>(instruction.<span class="property">address</span> - <span class="variable language_">module</span>.<span class="property">base</span>)])</span><br><span class="line">                                    times=times+<span class="number">1</span></span><br><span class="line">                                &#125;</span><br><span class="line">                                iterator.<span class="title function_">keep</span>();</span><br><span class="line">                            &#125; <span class="keyword">while</span> ((instruction = iterator.<span class="title function_">next</span>()) !== <span class="literal">null</span>);</span><br><span class="line">                        &#125;,</span><br><span class="line"> </span><br><span class="line">                        <span class="attr">onCallSummary</span>:<span class="keyword">function</span>(<span class="params">summary</span>)&#123;</span><br><span class="line"> </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Stalker end!&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(hook_dlopen, <span class="string">&quot;libsec2023.so&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>finally found crc detect function branch jump</p>
<p>.text:00000000000371D4                 CMP             W0, W8<br>.text:00000000000371D8                 MOV             W8, #0x28 ; ‘(‘<br>.text:00000000000371DC                 CSEL            X8, X8, X9, EQ</p>
<p><code>CSEL</code> is a branch structure instruction in arm, and the position of BR jump is determined by X8, so this assembly can change the program control flow.</p>
<p><code>CSEL X8, X8, X9, EQ</code> EQ stands for Equal, which is an equal condition. Its value is determined by the value obtained by comparing the latest CMP. For example, the condition judged here is <code>CMP W0, W8</code> .</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(W0 == W8)&#123;</span><br><span class="line">    X8 = X8</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    X8 = X9</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The difference between X8 and X9 is 0x10, and the modification of X8 will lead to changes in the control flow. In order to prevent the control flow from steering to the wrong branch and causing frida to force exit after injection, we can patch the assembly here and change <code>CSEL X8, X8, X9, EQ</code> to <code>CSEL X8, X8, X8, EQ</code>, which will be assembled <code>08 01 89 9A</code> is modified to <code>08 01 88 9A</code> .</p>
<p>frida MemoryWrite dynamic patch</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_31164</span>(<span class="params"></span>)&#123;</span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable language_">module</span> = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(<span class="string">&quot;libsec2023.so&quot;</span>)</span><br><span class="line">    <span class="keyword">var</span> addr=<span class="variable language_">module</span>.<span class="property">base</span>.<span class="title function_">add</span>(<span class="string">&quot;0x31164&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> func =  <span class="keyword">new</span> <span class="title class_">NativePointer</span>(addr.<span class="title function_">toString</span>());</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] hook &#x27;</span>+func.<span class="title function_">toString</span>())</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(func, &#123;</span><br><span class="line">     </span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">      </span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;hook success&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">0</span>]);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">1</span>]);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(args[<span class="number">2</span>]);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;retvalue is :&quot;</span>, retval.<span class="title function_">toInt32</span>());</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;method onleave&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">anti_sec2023</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> currentApplication = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.ActivityThread&quot;</span>).<span class="title function_">currentApplication</span>();</span><br><span class="line">        <span class="keyword">var</span> libso = <span class="title class_">Process</span>.<span class="title function_">getModuleByName</span>(<span class="string">&quot;libsec2023.so&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[name]:&quot;</span>, libso.<span class="property">name</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[base]:&quot;</span>, libso.<span class="property">base</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[size]:&quot;</span>, <span class="title function_">ptr</span>(libso.<span class="property">size</span>));</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[path]:&quot;</span>, libso.<span class="property">path</span>);</span><br><span class="line">        <span class="title class_">Memory</span>.<span class="title function_">protect</span>(<span class="title function_">ptr</span>(libso.<span class="property">base</span>), libso.<span class="property">size</span>, <span class="string">&#x27;rwx&#x27;</span>);</span><br><span class="line">        <span class="title class_">Memory</span>.<span class="title function_">writeByteArray</span>(<span class="title function_">ptr</span>(libso.<span class="property">base</span>).<span class="title function_">add</span>(<span class="number">0x371DC</span>),[<span class="number">0x08</span>,<span class="number">0x01</span>,<span class="number">0x88</span>,<span class="number">0x9A</span>]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">rpc.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">anti_sec2023</span>: anti_sec2023</span><br><span class="line">		<span class="attr">hook_31164</span>: hook_31164</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>There are also a large number of fancy instructions in the form of CSEL-BR reg, which can prevent the function from being parsed normally by ida, and the next instruction will actually continue to be executed after br. There are also normal selection statements hidden in these fancy instructions. block, or skip a few statements. Remove CSEL-BR and CSET-BR structures :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">CSEL_op1 = idc.print_operand(CSEL_addr, <span class="number">0</span>)</span><br><span class="line">CSEL_op2 = idc.print_operand(CSEL_addr, <span class="number">1</span>)</span><br><span class="line">CSEL_op2_val = -<span class="number">1</span></span><br><span class="line">CSEL_op3 = idc.print_operand(CSEL_addr, <span class="number">2</span>)</span><br><span class="line">CSEL_op3_val = -<span class="number">1</span></span><br><span class="line">CSEL_cond = idc.print_operand(CSEL_addr, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> jump_array_addr == -<span class="number">1</span>:</span><br><span class="line">    temp_addr = CSEL_addr</span><br><span class="line">    <span class="keyword">while</span> temp_addr &gt; text_seg.start_ea:</span><br><span class="line">         <span class="keyword">if</span> idc.print_insn_mnem(temp_addr) == <span class="string">&quot;ADRL&quot;</span>:</span><br><span class="line">            <span class="keyword">if</span> idc.print_operand(temp_addr, <span class="number">0</span>) == jump_array_reg:</span><br><span class="line">                jump_array_addr = idc.get_operand_value(temp_addr, <span class="number">1</span>)</span><br><span class="line">                nop_addr_array_temp.append(temp_addr)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> idc.print_insn_mnem(temp_addr) == <span class="string">&quot;ADRP&quot;</span>:  </span><br><span class="line">            <span class="keyword">if</span> idc.print_operand(temp_addr, <span class="number">0</span>) == jump_array_reg:</span><br><span class="line">                jump_array_addr = idc.get_operand_value(temp_addr, <span class="number">1</span>)</span><br><span class="line">                nop_addr_array_temp.append(temp_addr)</span><br><span class="line">                <span class="keyword">while</span> temp_addr &lt; text_seg.end_ea:</span><br><span class="line">                    <span class="keyword">if</span> idc.print_insn_mnem(temp_addr) == <span class="string">&quot;ADD&quot;</span>:</span><br><span class="line">                        <span class="keyword">if</span> idc.print_operand(temp_addr, <span class="number">0</span>) == jump_array_reg:</span><br><span class="line">                            jump_array_addr += idc.get_operand_value(temp_addr, <span class="number">2</span>)</span><br><span class="line">                            nop_addr_array_temp.append(temp_addr)</span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                    temp_addr = idc.next_head(temp_addr)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        temp_addr = idc.prev_head(temp_addr)</span><br><span class="line"></span><br><span class="line">     </span><br></pre></td></tr></table></figure>

<p>Or Step 4: use unicorn to get rid of it <a target="_blank" rel="noopener" href="https://github.com/mFallW1nd/deflat/blob/master/emu_utils.py">https://github.com/mFallW1nd/deflat/blob/master/emu_utils.py</a></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">from emu_utils import *</span><br><span class="line">from unicorn import *</span><br><span class="line">from unicorn.arm64_const import *</span><br><span class="line"><span class="meta"># from ida_bytes import *</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def <span class="title function_">trace_back_insn_with_target</span><span class="params">(insn_queue, target_reg)</span>:</span><br><span class="line">    <span class="keyword">for</span> insn in insn_queue:</span><br><span class="line">        <span class="title function_">if</span> <span class="params">(target_reg in insn.op_str)</span>:</span><br><span class="line">            <span class="title function_">if</span> <span class="params">(insn.mnemonic == <span class="string">&#x27;add&#x27;</span>)</span>:</span><br><span class="line">                <span class="title function_">print</span><span class="params">(insn.mnemonic + <span class="string">&#x27;\t&#x27;</span> + insn.op_str)</span></span><br><span class="line">        <span class="title function_">if</span> <span class="params">(insn.mnemonic == <span class="string">&#x27;ldr&#x27;</span>)</span>:</span><br><span class="line">            <span class="title function_">print</span><span class="params">(insn.mnemonic + <span class="string">&#x27;\t&#x27;</span> + insn.op_str)</span></span><br><span class="line">        <span class="title function_">if</span> <span class="params">(insn.mnemonic == <span class="string">&#x27;csel&#x27;</span>)</span>:</span><br><span class="line">            <span class="title function_">print</span><span class="params">(insn.mnemonic + <span class="string">&#x27;\t&#x27;</span> + insn.op_str)</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def <span class="title function_">log_hook</span><span class="params">(emu, addr, size, user_data)</span>:</span><br><span class="line">    disasm = get_disasm(emu, addr, size)</span><br><span class="line"> </span><br><span class="line">    print(hex(addr) + <span class="string">&#x27;\t&#x27;</span> + disasm.mnemonic + <span class="string">&#x27;\t&#x27;</span> + disasm.op_str)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def <span class="title function_">step_over_hook</span><span class="params">(emu, addr, size, none)</span>:</span><br><span class="line">    disasm = get_disasm(emu, addr, size)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (disasm.mnemonic == <span class="string">&#x27;bl&#x27;</span> or disasm.mnemonic == <span class="string">&#x27;blr&#x27;</span>):</span><br><span class="line">        emu.reg_write(UC_ARM64_REG_PC, addr + size)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (disasm.mnemonic == <span class="string">&#x27;ret&#x27;</span>):</span><br><span class="line">        print(<span class="string">&#x27;function returned&#x27;</span>)</span><br><span class="line">        emu.emu_stop()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> (addr == <span class="number">0x3ac68</span>):</span><br><span class="line">        emu.reg_write(UC_ARM64_REG_W10, <span class="number">0xEECF7326</span>)</span><br></pre></td></tr></table></figure>

<p>S<strong>tep 5 : Reverse the  encrypt</strong></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_3B9D4</span><span class="params">(__int64 result)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// x8</span></span><br><span class="line">  __int64 v2; <span class="comment">// x10</span></span><br><span class="line">  <span class="type">int</span> v3; <span class="comment">// w11</span></span><br><span class="line">  __int64 v4; <span class="comment">// x11</span></span><br><span class="line">  <span class="type">int</span> v5; <span class="comment">// w10</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// w12</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v7; <span class="comment">// w14</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// [xsp+Ch] [xbp-4h]</span></span><br><span class="line"> </span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; <span class="number">2</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = <span class="number">3LL</span>;</span><br><span class="line">    v8 = <span class="number">0</span>;</span><br><span class="line">    v3 = <span class="number">24</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      *((_BYTE *)&amp;v8 + v2) = (*(_DWORD *)(result + <span class="number">4</span> * i) &gt;&gt; v3) ^ v2;</span><br><span class="line">      --v2;</span><br><span class="line">      v3 -= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v2 &gt;= <span class="number">0</span> );</span><br><span class="line">    HIBYTE(v8) ^= <span class="number">0x86</span>u;</span><br><span class="line">    BYTE2(v8) -= <span class="number">94</span>;</span><br><span class="line">    v4 = <span class="number">3LL</span>;</span><br><span class="line">    BYTE1(v8) ^= <span class="number">0xD3</span>u;</span><br><span class="line">    LOBYTE(v8) = v8 - <span class="number">28</span>;</span><br><span class="line">    *(_DWORD *)(result + <span class="number">4</span> * i) = <span class="number">0</span>;</span><br><span class="line">    v5 = <span class="number">0</span>;</span><br><span class="line">    v6 = <span class="number">24</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v7 = *((_BYTE *)&amp;v8 + v4) - v6;</span><br><span class="line">      *((_BYTE *)&amp;v8 + v4--) = v7;</span><br><span class="line">      v5 += v7 &lt;&lt; v6;</span><br><span class="line">      *(_DWORD *)(result + <span class="number">4</span> * i) = v5;</span><br><span class="line">      v6 -= <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v4 &gt;= <span class="number">0</span> );</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>if its occured <code>HIBYTE</code> , <code>BYTE2</code>, <code>BYTE1</code>,<code>LOBYTE</code> is represent as following,Assume there is <code>a1=0x12345678</code>, well:</p>
<table>
<thead>
<tr>
<th>Symbol</th>
<th>Value</th>
</tr>
</thead>
<tbody><tr>
<td>HIBYTE(a1)</td>
<td>0x12</td>
</tr>
<tr>
<td>BYTE2(a1)</td>
<td>0x34</td>
</tr>
<tr>
<td>BYTE1(a1)</td>
<td>0x56</td>
</tr>
<tr>
<td>LOBYTE(a1)</td>
<td>0x78</td>
</tr>
</tbody></table>
<p>Then bswap32(v6) here is a byte flip of v6, and v6 &#x3D; HIDWORD(a1), so after performing the first encryption function sub_3B9D4, the high 32 bits of the input will be encrypted first.</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">algorithm_1 = &#123;</span><br><span class="line">    (<span class="number">0</span>, <span class="string">&quot;dec&quot;</span>): lambda x: (x + <span class="number">28</span>) &amp; <span class="number">0xff</span>,</span><br><span class="line">    (<span class="number">1</span>, <span class="string">&quot;dec&quot;</span>): lambda x: x ^ <span class="number">0xd3</span>,</span><br><span class="line">    (<span class="number">2</span>, <span class="string">&quot;dec&quot;</span>): lambda x: (x + <span class="number">94</span>) &amp; <span class="number">0xff</span>,</span><br><span class="line">    (<span class="number">3</span>, <span class="string">&quot;dec&quot;</span>): lambda x: x ^ <span class="number">0x86</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">def dec_1(input):</span><br><span class="line">    input_byte = bytearray(input.to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> i in range(len(input_byte)):</span><br><span class="line">        index = i % <span class="number">4</span></span><br><span class="line">        input_byte[i] = (algorithm_1[(index, <span class="string">&quot;dec&quot;</span>)]((input_byte[i] + <span class="number">8</span> * index) &amp; <span class="number">0xff</span>)) ^ index</span><br><span class="line">    <span class="keyword">return</span> <span class="type">int</span>.from_bytes(input_byte, <span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">input = ()  </span><br><span class="line">input = dec_1(input)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>we change 1480 pointer type to JNIEnv * and hook jni function <code>GetStaticMethodID</code></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//hook GetStaticMethodID</span></span><br><span class="line">function <span class="title function_">hook_GetStaticMethodID</span><span class="params">()</span> &#123;</span><br><span class="line">    var symbols = Module.enumerateSymbolsSync(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    var addr_jni = null;</span><br><span class="line">    <span class="keyword">for</span> (var i = <span class="number">0</span>; i &lt; symbols.length; i++) &#123;</span><br><span class="line">        var symbol = symbols[i];</span><br><span class="line">        <span class="keyword">if</span> (symbol.name.indexOf(<span class="string">&quot;GetStaticMethodID&quot;</span>)!=<span class="number">-1</span>) &#123;</span><br><span class="line">            addr_jni = symbol.address;</span><br><span class="line">            console.<span class="built_in">log</span>(<span class="string">&quot;find &quot;</span>,symbol.name);</span><br><span class="line">            console.<span class="built_in">log</span>(<span class="string">&quot;[+] hook &quot;</span>,addr_jni);</span><br><span class="line">            Interceptor.attach(addr_jni, &#123;</span><br><span class="line">                onEnter: function (args) &#123;</span><br><span class="line">                    console.<span class="built_in">log</span>(<span class="string">&quot;call GetStaticMethodID: &quot;</span>,symbol.name);</span><br><span class="line">                    console.<span class="built_in">log</span>(<span class="string">&quot;name: &quot;</span>,args[<span class="number">2</span>].readCString());</span><br><span class="line">                    console.<span class="built_in">log</span>(<span class="string">&quot;sig: &quot;</span>,args[<span class="number">3</span>].readCString());</span><br><span class="line">                &#125;,</span><br><span class="line">                onLeave: function (retval) &#123;</span><br><span class="line">                    <span class="comment">//console.log(&quot;return val&quot;)</span></span><br><span class="line">                    <span class="comment">//console.log(retval);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/archives/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/yushusu">Projects</a></li>
        
      </ul>
    </div>

    
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&text=sec2023_mobile-1"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&is_video=false&description=sec2023_mobile-1"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=sec2023_mobile-1&body=Check out this article: http://yushusu.github.io/2023/10/05/sec2023-mobile-1/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&title=sec2023_mobile-1"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&name=sec2023_mobile-1&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://yushusu.github.io/2023/10/05/sec2023-mobile-1/&t=sec2023_mobile-1"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2023
    yushusu
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/archives/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/yushusu">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
